---
# Docker Compose - Dashboard Only (External Database)
#
# Usage:
#   cp .env.docker.example .env.docker
#   # Edit .env.docker with your external DATABASE_URL
#   docker compose -f docker-compose.external-db.yml up -d
#
# Use this when connecting to:
#   - Supabase
#   - Neon
#   - Amazon RDS
#   - Any external PostgreSQL

services:
  # Next.js Dashboard
  dashboard:
    build:
      context: ./dashboard
      dockerfile: Dockerfile
    image: wab-dashboard:latest
    container_name: wab-dashboard
    restart: unless-stopped
    environment:
      # Database - external PostgreSQL
      DATABASE_URL: ${DATABASE_URL:?DATABASE_URL is required}

      # NextAuth
      NEXTAUTH_SECRET: ${NEXTAUTH_SECRET:?NEXTAUTH_SECRET is required}
      NEXTAUTH_URL: ${NEXTAUTH_URL:-http://localhost:3000}

      # Google OAuth (optional)
      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID:-}
      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET:-}

      # Node environment
      NODE_ENV: production

      # Run database migrations on startup (set to true for first run)
      RUN_MIGRATIONS: ${RUN_MIGRATIONS:-false}
    ports:
      - "${DASHBOARD_PORT:-3000}:3000"
    healthcheck:
      test:
        - CMD
        - wget
        - "-q"
        - "--spider"
        - "http://localhost:3000/api/health"
      interval: 30s
      timeout: 10s
      start_period: 10s
      retries: 3
    networks:
      - wab-network

networks:
  wab-network:
    driver: bridge
